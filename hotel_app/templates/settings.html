<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="{{ url_for('static', filename='images/ico.png') }}" type="image/x-icon">
        <title>Settings - trivago</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.6.6/css/flag-icons.min.css">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/user.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/translate.css') }}">
        <!-- TailwindCSS -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
            rel="stylesheet">
        <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>
        <script defer src="{{ url_for('static', filename='js/translate.js') }}"></script>
        <script defer src="{{ url_for('static', filename='js/user.js') }}"></script>
    </head>

    <body class="luxury-bg min-h-screen">
        <!-- Header -->
        <header class="sticky h-16 top-0 z-50 bg-[#2563eb] shadow-sm py-2 md:py-4 px-4 md:px-8">
            <div class="flex items-center justify-start gap-8 text-white h-full">
                <button onclick="history.back()" class="text-white hover:text-blue-200 transition-colors">
                    <i class="fas fa-arrow-left text-xl"></i>
                </button>
                <h1 class="text-white text-sm md:text-md font-bold">Settings</h1>
            </div>
        </header>

        <div class="max-w-4xl mx-auto px-4 py-6 space-y-6">
            <!-- Flash Messages -->
            <div id="flashMessages" class="hidden">
                <div id="successMessage"
                    class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-4 hidden">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle mr-2"></i>
                        <span id="successText"></span>
                    </div>
                </div>
                <div id="errorMessage"
                    class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-4 hidden">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        <span id="errorText"></span>
                    </div>
                </div>
            </div>

            <!-- Language Preferences -->
            <div class="bg-white rounded-2xl shadow-lg overflow-visible">
                <div class="p-6 cursor-pointer hover:bg-gray-50 transition-colors" onclick="toggleLanguageSettings()">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-language text-blue-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-sm sm:text-xl font-bold text-gray-900">Language Preferences</h3>
                                <p class="text-xs sm:text-sm text-gray-600">Choose your preferred language</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400 transform transition-transform"
                            id="language-icon"></i>
                    </div>
                </div>

                <div class="language-content hidden" id="language-content">
                    <div class="px-6 pb-6 border-t border-gray-100">
                        <div class="pt-6">
                            <label class="block text-xs sm:text-sm font-medium text-gray-700 mb-3">Select
                                Language</label>
                            <div class="relative z-50">
                                <button onclick="toggleLanguageDropdown()"
                                    class="w-full flex items-center justify-between px-4 py-3 border border-gray-300 rounded-lg hover:border-blue-500 focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                                    <div class="flex items-center gap-3">
                                        <span id="selectedLanguageFlag" class="fi fi-us flag-icon"></span>
                                        <span id="selectedLanguageText">English</span>
                                    </div>
                                    <i class="fas fa-chevron-down text-gray-400 transform transition-transform"
                                        id="languageChevron"></i>
                                </button>

                                <!-- Language Dropdown -->
                                <div id="languageDropdown"
                                    class="absolute top-full left-0 right-0 mt-2 bg-white border border-gray-200 rounded-lg shadow-xl z-50 overflow-hidden hidden">
                                    <div class="py-1 max-h-60 overflow-y-auto">
                                        <div class="flex items-center gap-3 px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors bg-blue-50 text-blue-600 font-medium"
                                            onclick="selectLanguage('en', 'us', 'English', 'EN')">
                                            <span class="fi fi-us flag-icon"></span>
                                            <span class="flex-1">English</span>
                                            <span class="text-xs text-gray-500">EN</span>
                                        </div>
                                        <div class="flex items-center gap-3 px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors"
                                            onclick="selectLanguage('pt', 'pt', 'Português', 'PT')">
                                            <span class="fi fi-pt flag-icon"></span>
                                            <span class="flex-1">Português</span>
                                            <span class="text-xs text-gray-500">PT</span>
                                        </div>
                                        <div class="flex items-center gap-3 px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors"
                                            onclick="selectLanguage('es', 'es', 'Español', 'ES')">
                                            <span class="fi fi-es flag-icon"></span>
                                            <span class="flex-1">Español</span>
                                            <span class="text-xs text-gray-500">ES</span>
                                        </div>
                                        <div class="flex items-center gap-3 px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors"
                                            onclick="selectLanguage('it', 'it', 'Italiano', 'IT')">
                                            <span class="fi fi-it flag-icon"></span>
                                            <span class="flex-1">Italiano</span>
                                            <span class="text-xs text-gray-500">IT</span>
                                        </div>
                                        <div class="flex items-center gap-3 px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors"
                                            onclick="selectLanguage('fr', 'fr', 'Français', 'FR')">
                                            <span class="fi fi-fr flag-icon"></span>
                                            <span class="flex-1">Français</span>
                                            <span class="text-xs text-gray-500">FR</span>
                                        </div>
                                        <div class="flex items-center gap-3 px-4 py-3 hover:bg-gray-50 cursor-pointer transition-colors"
                                            onclick="selectLanguage('de', 'de', 'Deutsch', 'DE')">
                                            <span class="fi fi-de flag-icon"></span>
                                            <span class="flex-1">Deutsch</span>
                                            <span class="text-xs text-gray-500">DE</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Settings -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div class="p-6 cursor-pointer hover:bg-gray-50 transition-colors" onclick="toggleLoginSettings()">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-key text-green-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-sm sm:text-xl font-bold text-gray-900">Change Login Password</h3>
                                <p class="text-xs sm:text-sm text-gray-600">Manage your Login passwords</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-down text-gray-400 transform transition-transform" id="login-icon"></i>
                    </div>
                </div>

                <div class="security-content hidden" id="login-content">
                    <div class="px-6 pb-6 border-t border-gray-100">
                        <div class="pt-6 space-y-6">
                            <!-- Change Login Password -->
                            <div class="bg-gray-50 rounded-lg p-4">
                                <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
                                    <i class="fas fa-key text-blue-600 mr-2"></i>
                                    Change Login Password
                                </h4>
                                <form id="passwordChangeForm" onsubmit="changeLoginPassword(event)">
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">User
                                                Identifier</label>
                                            <input type="text" id="userIdentifier" name="user_identifier"
                                                placeholder="Enter your User ID, Contact, or Nickname"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                                required>
                                            <p class="text-xs text-gray-500 mt-1">Use your User ID, phone number, or
                                                nickname</p>
                                        </div>
                                        <div class="grid md:grid-cols-2 gap-4">
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">New
                                                    Password</label>
                                                <input type="password" id="newPassword" name="new_password"
                                                    placeholder="Enter new password"
                                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                                    required minlength="6">
                                            </div>
                                            <div>
                                                <label class="block text-sm font-medium text-gray-700 mb-2">Confirm
                                                    Password</label>
                                                <input type="password" id="confirmPassword" name="confirm_password"
                                                    placeholder="Confirm new password"
                                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                                    required minlength="6">
                                            </div>
                                        </div>
                                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                            <div class="flex items-start gap-2">
                                                <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                                                <div class="text-sm text-blue-800">
                                                    <p class="font-medium mb-1">Password Requirements:</p>
                                                    <ul class="space-y-1 text-xs">
                                                        <li>• Minimum 6 characters long</li>
                                                        <li>• Use a strong, unique password</li>
                                                        <li>• Don't use the same password as other accounts</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>
                                        <button type="submit" id="passwordChangeBtn"
                                            class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition-colors">
                                            <i class="fas fa-save mr-2"></i>Update Password
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Withdrawal Password -->
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <div onclick="window.location.href='set-withdrawal-password'"
                    class="p-8 cursor-pointer hover:bg-gray-50 transition-colors">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                <i class="fas fa-shield-alt text-green-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="text-sm sm:text-xl font-bold text-gray-900">Set Withdrawal Password</h3>
                                <p class="text-xs sm:text-sm text-gray-600">Manage your withdrawal passwords</p>
                            </div>
                        </div>
                        <i class="fas fa-chevron-right text-gray-400 transform transition-transform"></i>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Show flash messages
            function showMessage(type, message) {
                const flashContainer = document.getElementById('flashMessages');
                const successMsg = document.getElementById('successMessage');
                const errorMsg = document.getElementById('errorMessage');

                // Hide all messages first
                successMsg.classList.add('hidden');
                errorMsg.classList.add('hidden');

                if (type === 'success') {
                    document.getElementById('successText').textContent = message;
                    successMsg.classList.remove('hidden');
                } else {
                    document.getElementById('errorText').textContent = message;
                    errorMsg.classList.remove('hidden');
                }

                flashContainer.classList.remove('hidden');

                // Auto-hide after 5 seconds
                setTimeout(() => {
                    flashContainer.classList.add('hidden');
                }, 5000);

                // Scroll to top to show message
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            // Language Settings Functions
            function toggleLanguageSettings() {
                const content = document.getElementById('language-content');
                const icon = document.getElementById('language-icon');

                content.classList.toggle('hidden');
                icon.classList.toggle('rotate-180');
            }

            function toggleLanguageDropdown() {
                const dropdown = document.getElementById('languageDropdown');
                const chevron = document.getElementById('languageChevron');

                dropdown.classList.toggle('hidden');
                chevron.classList.toggle('rotate-180');
            }

            function selectLanguage(langCode, flagCode, langName, shortCode) {
                const flagElement = document.getElementById('selectedLanguageFlag');
                const textElement = document.getElementById('selectedLanguageText');
                const dropdown = document.getElementById('languageDropdown');
                const chevron = document.getElementById('languageChevron');

                // Update selected language display
                flagElement.className = `fi fi-${flagCode} flag-icon`;
                textElement.textContent = langName;

                // Close dropdown
                dropdown.classList.add('hidden');
                chevron.classList.remove('rotate-180');

                // Update active state in dropdown
                const allOptions = dropdown.querySelectorAll('[onclick*="selectLanguage"]');
                allOptions.forEach(option => {
                    option.classList.remove('bg-blue-50', 'text-blue-600', 'font-medium');
                    option.classList.add('hover:bg-gray-50');
                });

                // Add active state to selected option
                const selectedOption = dropdown.querySelector(`[onclick*="'${langCode}'"]`);
                if (selectedOption) {
                    selectedOption.classList.add('bg-blue-50', 'text-blue-600', 'font-medium');
                    selectedOption.classList.remove('hover:bg-gray-50');
                }

                // Apply translation (you can integrate with your translation system here)
                if (typeof translateToLanguage === 'function') {
                    translateToLanguage(langCode, langName);
                }

                showMessage('success', `Language changed to ${langName}`);
            }

            // Security Settings Functions
            function toggleLoginSettings() {
                const content = document.getElementById('login-content');
                const icon = document.getElementById('login-icon');

                content.classList.toggle('hidden');
                icon.classList.toggle('rotate-180');
            }

            function changeLoginPassword(event) {
                event.preventDefault();

                const form = document.getElementById('passwordChangeForm');
                const btn = document.getElementById('passwordChangeBtn');
                const formData = new FormData(form);

                // Client-side validation
                const userIdentifier = formData.get('user_identifier');
                const newPassword = formData.get('new_password');
                const confirmPassword = formData.get('confirm_password');

                if (!userIdentifier.trim()) {
                    showMessage('error', 'User identifier is required');
                    return;
                }

                if (!newPassword || newPassword.length < 6) {
                    showMessage('error', 'Password must be at least 6 characters long');
                    return;
                }

                if (newPassword !== confirmPassword) {
                    showMessage('error', 'Passwords do not match');
                    return;
                }

                // Show loading state
                const originalText = btn.innerHTML;
                btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Updating...';
                btn.disabled = true;

                // Send request to backend
                fetch('/password_reset', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_identifier: userIdentifier,
                        new_password: newPassword,
                        confirm_password: confirmPassword
                    })
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            showMessage('success', data.message);
                            form.reset();

                            // Optional: Close the dropdown after successful change
                            setTimeout(() => {
                                toggleLoginSettings();
                            }, 2000);
                        } else {
                            showMessage('error', data.message || 'Failed to update password');
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        showMessage('error', 'An error occurred while updating password');
                    })
                    .finally(() => {
                        // Reset button state
                        btn.innerHTML = originalText;
                        btn.disabled = false;
                    });
            }

            // Add smooth animations
            document.addEventListener('DOMContentLoaded', function () {
                const contents = document.querySelectorAll('.language-content, .security-content');
                contents.forEach(content => {
                    content.style.transition = 'all 0.3s ease';
                });
            });

            // Add smooth scroll behavior
            document.documentElement.style.scrollBehavior = 'smooth';
        </script>
    </body>

</html>