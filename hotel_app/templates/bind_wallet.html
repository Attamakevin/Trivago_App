<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="shortcut icon" href="{{ url_for('static', filename='images/ico.png') }}" type="image/x-icon">
        <title>Bind Wallet - trivago</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/lipis/flag-icons@6.6.6/css/flag-icons.min.css">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/user.css') }}">
        <link rel="stylesheet" href="{{ url_for('static', filename='css/translate.css') }}">
        <!-- TailwindCSS -->
        <script src="https://cdn.tailwindcss.com"></script>
        <!-- Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
            rel="stylesheet">
        <script defer src="{{ url_for('static', filename='js/main.js') }}"></script>
        <script defer src="{{ url_for('static', filename='js/translate.js') }}"></script>
        <script defer src="{{ url_for('static', filename='js/user.js') }}"></script>
    </head>

    <body class="bg-gray-50 min-h-screen">
        <!-- Header -->
        <header class="sticky h-16 top-0 z-50 bg-[#2563eb] shadow-sm py-2 md:py-4 px-4 md:px-8">
            <div class="flex items-center justify-start gap-8 text-white h-full">
                <button onclick="history.back()" class="text-white hover:text-blue-200 transition-colors">
                    <i class="fas fa-arrow-left text-xl"></i>
                </button>
                <h1 class="text-white text-sm md:text-md font-bold">Manage Wallets</h1>
            </div>
        </header>

        <div class="max-w-4xl mx-auto px-4 py-8">
            <!-- Page Header -->
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-wallet text-blue-600 text-3xl"></i>
                </div>
                <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-2">Manage Your Wallets</h2>
                <p class="text-gray-600">Connect multiple payment methods for seamless transactions</p>
            </div>

            <!-- Flash Messages -->
            <div id="flashMessages" class="hidden mb-6">
                <div id="successMessage" class="bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded-lg mb-4 hidden">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle mr-2"></i>
                        <span id="successText"></span>
                    </div>
                </div>
                <div id="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg mb-4 hidden">
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-circle mr-2"></i>
                        <span id="errorText"></span>
                    </div>
                </div>
            </div>

            <!-- Wallet Summary (if any wallets are bound) -->
            <div id="walletSummary" class="bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-6 mb-6 hidden">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-blue-900">Your Connected Wallets</h3>
                    <span id="connectedCount" class="px-3 py-1 bg-blue-100 text-blue-800 text-sm rounded-full font-medium">0 Connected</span>
                </div>
                <div id="connectedWalletsList" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Connected wallets will be shown here -->
                </div>
            </div>

            <!-- Wallet Forms -->
            <div class="space-y-6" id="walletForms">
                <!-- USDT Wallet -->
                <div class="bg-white rounded-lg shadow-md border-l-4 border-green-400">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                    <i class="fab fa-bitcoin text-green-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">USDT Wallet</h3>
                                    <p class="text-sm text-gray-600">Tether USD (TRC-20/ERC-20/Omni)</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span id="usdt-status" class="px-3 py-1 bg-gray-100 text-gray-700 text-xs rounded-full">Not Connected</span>
                                <button onclick="toggleWalletForm('usdt')" id="usdt-toggle-btn" class="text-blue-600 hover:text-blue-700">
                                    <i class="fas fa-plus text-lg" id="usdt-icon"></i>
                                </button>
                            </div>
                        </div>

                        <!-- USDT Connected Display -->
                        <div id="usdt-connected" class="border-t border-gray-200 pt-4 hidden">
                            <div class="bg-green-50 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-green-600 font-medium">Connected Wallet:</p>
                                        <p class="text-green-800 font-mono text-sm" id="usdt-display-address">Loading...</p>
                                        <p class="text-xs text-green-600 mt-1" id="usdt-bound-date">Bound on: Loading...</p>
                                    </div>
                                    <button onclick="editWallet('usdt')" class="text-green-600 hover:text-green-700">
                                        <i class="fas fa-edit text-lg"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- USDT Form -->
                        <div class="wallet-form hidden" id="usdt-form">
                            <div class="border-t border-gray-200 pt-6">
                                <form id="usdtForm" onsubmit="bindWallet(event, 'USDT')">
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                                <i class="fas fa-wallet text-gray-400 mr-2"></i>USDT Wallet Address
                                            </label>
                                            <input type="text" id="usdt-address" name="wallet_address"
                                                placeholder="Enter your USDT wallet address"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent transition-all"
                                                required>
                                            <p class="text-xs text-gray-500 mt-1">Supports TRC-20, ERC-20, and Omni networks</p>
                                        </div>

                                        <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                            <div class="flex items-start gap-3">
                                                <i class="fas fa-info-circle text-green-600 mt-1"></i>
                                                <div>
                                                    <h5 class="font-medium text-green-800 mb-1">Supported Formats:</h5>
                                                    <ul class="text-sm text-green-700 space-y-1">
                                                        <li>• <strong>TRC-20:</strong> Starts with 'T' (e.g., TQn9Y2khEsLJW1ChVWFMSMeRDow5KcbLSE)</li>
                                                        <li>• <strong>ERC-20:</strong> Starts with '0x' (e.g., 0x742d35Cc6634C0532925a3b8D40Ec6a)</li>
                                                        <li>• <strong>Omni:</strong> Bitcoin format (e.g., 1A1zP1eP5QGefi2DMPTfTL5SLmv7DivfNa)</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="flex gap-3 pt-4">
                                            <button type="submit" class="flex-1 bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-6 rounded-lg transition-all">
                                                <i class="fas fa-link mr-2"></i>
                                                <span id="usdt-btn-text">Bind USDT Wallet</span>
                                            </button>
                                            <button type="button" onclick="cancelWalletForm('usdt')" class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">
                                                <i class="fas fa-times mr-2"></i>Cancel
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ETH Wallet -->
                <div class="bg-white rounded-lg shadow-md border-l-4 border-purple-400">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center">
                                    <i class="fab fa-ethereum text-purple-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">Ethereum Wallet</h3>
                                    <p class="text-sm text-gray-600">Ethereum (ETH) wallet address</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span id="eth-status" class="px-3 py-1 bg-gray-100 text-gray-700 text-xs rounded-full">Not Connected</span>
                                <button onclick="toggleWalletForm('eth')" id="eth-toggle-btn" class="text-blue-600 hover:text-blue-700">
                                    <i class="fas fa-plus text-lg" id="eth-icon"></i>
                                </button>
                            </div>
                        </div>

                        <!-- ETH Connected Display -->
                        <div id="eth-connected" class="border-t border-gray-200 pt-4 hidden">
                            <div class="bg-purple-50 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-purple-600 font-medium">Connected Wallet:</p>
                                        <p class="text-purple-800 font-mono text-sm" id="eth-display-address">Loading...</p>
                                        <p class="text-xs text-purple-600 mt-1" id="eth-bound-date">Bound on: Loading...</p>
                                    </div>
                                    <button onclick="editWallet('eth')" class="text-purple-600 hover:text-purple-700">
                                        <i class="fas fa-edit text-lg"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- ETH Form -->
                        <div class="wallet-form hidden" id="eth-form">
                            <div class="border-t border-gray-200 pt-6">
                                <form id="ethForm" onsubmit="bindWallet(event, 'ETH')">
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                                <i class="fas fa-wallet text-gray-400 mr-2"></i>Ethereum Wallet Address
                                            </label>
                                            <input type="text" id="eth-address" name="wallet_address"
                                                placeholder="Enter your Ethereum wallet address"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all"
                                                required>
                                            <p class="text-xs text-gray-500 mt-1">Must start with '0x' followed by 40 hexadecimal characters</p>
                                        </div>

                                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                                            <div class="flex items-start gap-3">
                                                <i class="fas fa-info-circle text-purple-600 mt-1"></i>
                                                <div>
                                                    <h5 class="font-medium text-purple-800 mb-1">Ethereum Address Format:</h5>
                                                    <ul class="text-sm text-purple-700 space-y-1">
                                                        <li>• Must start with '0x'</li>
                                                        <li>• Followed by exactly 40 hexadecimal characters</li>
                                                        <li>• Example: 0x742d35Cc6634C0532925a3b8D40Ec6a</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="flex gap-3 pt-4">
                                            <button type="submit" class="flex-1 bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 px-6 rounded-lg transition-all">
                                                <i class="fas fa-link mr-2"></i>
                                                <span id="eth-btn-text">Bind ETH Wallet</span>
                                            </button>
                                            <button type="button" onclick="cancelWalletForm('eth')" class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">
                                                <i class="fas fa-times mr-2"></i>Cancel
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- PayPal Wallet -->
                <div class="bg-white rounded-lg shadow-md border-l-4 border-yellow-400">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
                                    <i class="fab fa-paypal text-yellow-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">PayPal Account</h3>
                                    <p class="text-sm text-gray-600">PayPal email address</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span id="paypal-status" class="px-3 py-1 bg-gray-100 text-gray-700 text-xs rounded-full">Not Connected</span>
                                <button onclick="toggleWalletForm('paypal')" id="paypal-toggle-btn" class="text-blue-600 hover:text-blue-700">
                                    <i class="fas fa-plus text-lg" id="paypal-icon"></i>
                                </button>
                            </div>
                        </div>

                        <!-- PayPal Connected Display -->
                        <div id="paypal-connected" class="border-t border-gray-200 pt-4 hidden">
                            <div class="bg-yellow-50 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-yellow-600 font-medium">Connected Account:</p>
                                        <p class="text-yellow-800 font-mono text-sm" id="paypal-display-address">Loading...</p>
                                        <p class="text-xs text-yellow-600 mt-1" id="paypal-bound-date">Bound on: Loading...</p>
                                    </div>
                                    <button onclick="editWallet('paypal')" class="text-yellow-600 hover:text-yellow-700">
                                        <i class="fas fa-edit text-lg"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- PayPal Form -->
                        <div class="wallet-form hidden" id="paypal-form">
                            <div class="border-t border-gray-200 pt-6">
                                <form id="paypalForm" onsubmit="bindWallet(event, 'PAYPAL')">
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                                <i class="fas fa-envelope text-gray-400 mr-2"></i>PayPal Email Address
                                            </label>
                                            <input type="email" id="paypal-address" name="wallet_address"
                                                placeholder="Enter your PayPal email address"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent transition-all"
                                                required>
                                            <p class="text-xs text-gray-500 mt-1">Must be the primary email address associated with your PayPal account</p>
                                        </div>

                                        <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                            <div class="flex items-start gap-3">
                                                <i class="fas fa-info-circle text-yellow-600 mt-1"></i>
                                                <div>
                                                    <h5 class="font-medium text-yellow-800 mb-1">PayPal Requirements:</h5>
                                                    <ul class="text-sm text-yellow-700 space-y-1">
                                                        <li>• Use your verified PayPal email address</li>
                                                        <li>• Account must be active and in good standing</li>
                                                        <li>• Ensure your account can receive payments</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="flex gap-3 pt-4">
                                            <button type="submit" class="flex-1 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 px-6 rounded-lg transition-all">
                                                <i class="fas fa-link mr-2"></i>
                                                <span id="paypal-btn-text">Bind PayPal Account</span>
                                            </button>
                                            <button type="button" onclick="cancelWalletForm('paypal')" class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">
                                                <i class="fas fa-times mr-2"></i>Cancel
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Revolut Wallet -->
                <div class="bg-white rounded-lg shadow-md border-l-4 border-blue-400">
                    <div class="p-6">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center">
                                    <i class="fas fa-university text-blue-600 text-xl"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900">Revolut Account</h3>
                                    <p class="text-sm text-gray-600">Revolut email or phone number</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span id="revolut-status" class="px-3 py-1 bg-gray-100 text-gray-700 text-xs rounded-full">Not Connected</span>
                                <button onclick="toggleWalletForm('revolut')" id="revolut-toggle-btn" class="text-blue-600 hover:text-blue-700">
                                    <i class="fas fa-plus text-lg" id="revolut-icon"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Revolut Connected Display -->
                        <div id="revolut-connected" class="border-t border-gray-200 pt-4 hidden">
                            <div class="bg-blue-50 rounded-lg p-4">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-blue-600 font-medium">Connected Account:</p>
                                        <p class="text-blue-800 font-mono text-sm" id="revolut-display-address">Loading...</p>
                                        <p class="text-xs text-blue-600 mt-1" id="revolut-bound-date">Bound on: Loading...</p>
                                    </div>
                                    <button onclick="editWallet('revolut')" class="text-blue-600 hover:text-blue-700">
                                        <i class="fas fa-edit text-lg"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Revolut Form -->
                        <div class="wallet-form hidden" id="revolut-form">
                            <div class="border-t border-gray-200 pt-6">
                                <form id="revolutForm" onsubmit="bindWallet(event, 'REVOLUT')">
                                    <div class="space-y-4">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                                <i class="fas fa-envelope text-gray-400 mr-2"></i>Revolut Email or Phone
                                            </label>
                                            <input type="text" id="revolut-address" name="wallet_address"
                                                placeholder="Enter your Revolut email or phone number"
                                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                                                required>
                                            <p class="text-xs text-gray-500 mt-1">Use your primary email address or phone number associated with your Revolut account</p>
                                        </div>

                                        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                            <div class="flex items-start gap-3">
                                                <i class="fas fa-info-circle text-blue-600 mt-1"></i>
                                                <div>
                                                    <h5 class="font-medium text-blue-800 mb-1">Revolut Requirements:</h5>
                                                    <ul class="text-sm text-blue-700 space-y-1">
                                                        <li>• Use verified email or phone number</li>
                                                        <li>• Account must be active and verified</li>
                                                        <li>• Ensure your account can receive transfers</li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </div>

                                        <div class="flex gap-3 pt-4">
                                            <button type="submit" class="flex-1 bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition-all">
                                                <i class="fas fa-link mr-2"></i>
                                                <span id="revolut-btn-text">Bind Revolut Account</span>
                                            </button>
                                            <button type="button" onclick="cancelWalletForm('revolut')" class="px-6 py-3 border border-gray-300 text-gray-700 font-medium rounded-lg hover:bg-gray-50 transition-colors">
                                                <i class="fas fa-times mr-2"></i>Cancel
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Store wallet data
            let walletData = {};

            // Show flash messages
            function showMessage(type, message) {
                const flashContainer = document.getElementById('flashMessages');
                const successMsg = document.getElementById('successMessage');
                const errorMsg = document.getElementById('errorMessage');
                
                successMsg.classList.add('hidden');
                errorMsg.classList.add('hidden');
                
                if (type === 'success') {
                    document.getElementById('successText').textContent = message;
                    successMsg.classList.remove('hidden');
                } else {
                    document.getElementById('errorText').textContent = message;
                    errorMsg.classList.remove('hidden');
                }
                
                flashContainer.classList.remove('hidden');
                
                setTimeout(() => {
                    flashContainer.classList.add('hidden');
                }, 5000);
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }

            // Load wallet data on page load
            function loadWalletData() {
                fetch('/get_wallet_info')
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            walletData = data.wallets || {};
                            updateWalletDisplay();
                        }
                    })
                    .catch(error => {
                        console.error('Error loading wallet data:', error);
                    });
            }

            // Update wallet display based on loaded data
            function updateWalletDisplay() {
                const walletTypes = ['usdt', 'eth', 'paypal', 'revolut'];
                let connectedCount = 0;
                
                walletTypes.forEach(type => {
                    if (walletData[type]) {
                        setWalletConnected(type, walletData[type].address, walletData[type].bound_at);
                        connectedCount++;
                    }
                });
                
                updateSummary(connectedCount);
            }

            // Set wallet as connected
            function setWalletConnected(walletType, address, boundAt) {
                const statusElement = document.getElementById(walletType + '-status');
                const connectedDiv = document.getElementById(walletType + '-connected');
                const addressElement = document.getElementById(walletType + '-display-address');
                const dateElement = document.getElementById(walletType + '-bound-date');
                const btnText = document.getElementById(walletType + '-btn-text');
                
                // Update status
                statusElement.textContent = 'Connected';
                statusElement.className = 'px-3 py-1 bg-green-100 text-green-800 text-xs rounded-full';
                
                // Show connected info
                connectedDiv.classList.remove('hidden');
                addressElement.textContent = address.length > 20 ? address.substring(0, 10) + '...' + address.substring(address.length - 10) : address;
                dateElement.textContent = 'Bound on: ' + (boundAt ? new Date(boundAt).toLocaleDateString() : 'Unknown');
                
                // Update button text
                btnText.textContent = 'Update ' + walletType.toUpperCase() + ' Wallet';
                
                // Pre-fill form
                const inputElement = document.getElementById(walletType + '-address');
                if (inputElement) {
                    inputElement.value = address;
                }
            }

            // Update summary section
            function updateSummary(count) {
                const summaryDiv = document.getElementById('walletSummary');
                const countElement = document.getElementById('connectedCount');
                const listElement = document.getElementById('connectedWalletsList');
                
                if (count > 0) {
                    summaryDiv.classList.remove('hidden');
                    countElement.textContent = count + ' Connected';
                    
                    // Build connected wallets list
                    let html = '';
                    Object.keys(walletData).forEach(type => {
                        const data = walletData[type];
                        const colors = {
                            usdt: 'green',
                            eth: 'purple',
                            paypal: 'yellow',
                            revolut: 'blue'
                        };
                        const color = colors[type] || 'gray';
                        
                        html += `
                            <div class="bg-${color}-50 border border-${color}-200 rounded-lg p-3">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="font-medium text-${color}-800">${type.toUpperCase()}</p>
                                        <p class="text-xs text-${color}-600 font-mono">${data.address.substring(0, 10)}...${data.address.substring(data.address.length - 6)}</p>
                                    </div>
                                    <button onclick="editWallet('${type}')" class="text-${color}-600 hover:text-${color}-700">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                            </div>
                        `;
                    });
                    listElement.innerHTML = html;
                } else {
                    summaryDiv.classList.add('hidden');
                }
            }

            // Toggle wallet form display
            function toggleWalletForm(walletType) {
                const form = document.getElementById(walletType + '-form');
                const icon = document.getElementById(walletType + '-icon');
                const connectedDiv = document.getElementById(walletType + '-connected');
                
                if (form.classList.contains('hidden')) {
                    // Close all other forms first
                    const allForms = document.querySelectorAll('.wallet-form');
                    const allIcons = document.querySelectorAll('[id$="-icon"]');
                    
                    allForms.forEach(f => f.classList.add('hidden'));
                    allIcons.forEach(i => {
                        i.className = 'fas fa-plus text-lg';
                    });
                    
                    // Hide connected display
                    if (connectedDiv) {
                        connectedDiv.classList.add('hidden');
                    }
                    
                    // Open this form
                    form.classList.remove('hidden');
                    icon.className = 'fas fa-minus text-lg';
                } else {
                    // Close this form
                    form.classList.add('hidden');
                    icon.className = 'fas fa-plus text-lg';
                    
                    // Show connected display if wallet is connected
                    if (walletData[walletType] && connectedDiv) {
                        connectedDiv.classList.remove('hidden');
                    }
                }
            }

            // Edit wallet (same as toggle form)
            function editWallet(walletType) {
                toggleWalletForm(walletType);
            }

            // Cancel wallet form
            function cancelWalletForm(walletType) {
                const form = document.getElementById(walletType + '-form');
                const icon = document.getElementById(walletType + '-icon');
                const connectedDiv = document.getElementById(walletType + '-connected');
                
                // Hide form
                form.classList.add('hidden');
                icon.className = 'fas fa-plus text-lg';
                
                // Show connected display if wallet is connected
                if (walletData[walletType] && connectedDiv) {
                    connectedDiv.classList.remove('hidden');
                }
            }

            // Bind/Update wallet function
            function bindWallet(event, walletType) {
                event.preventDefault();
                
                const form = event.target;
                const submitBtn = form.querySelector('button[type="submit"]');
                const walletAddress = form.querySelector('input[name="wallet_address"]').value.trim();
                
                if (!walletAddress) {
                    showMessage('error', 'Please enter a wallet address');
                    return;
                }
                
                const isUpdate = walletData[walletType.toLowerCase()] ? true : false;
                
                // Show loading state
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>' + (isUpdate ? 'Updating...' : 'Binding...');
                submitBtn.disabled = true;
                
                // Send request to backend
                fetch('/bind_wallet', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        wallet_type: walletType,
                        wallet_address: walletAddress
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showMessage('success', data.message);
                        
                        // Update local wallet data
                        walletData[walletType.toLowerCase()] = {
                            address: walletAddress,
                            bound_at: new Date().toISOString()
                        };
                        
                        // Update display
                        setWalletConnected(walletType.toLowerCase(), walletAddress, new Date().toISOString());
                        updateSummary(Object.keys(walletData).length);
                        
                        // Hide form
                        cancelWalletForm(walletType.toLowerCase());
                    } else {
                        showMessage('error', data.message || 'Failed to ' + (isUpdate ? 'update' : 'bind') + ' wallet');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showMessage('error', 'An error occurred while ' + (isUpdate ? 'updating' : 'binding') + ' wallet');
                })
                .finally(() => {
                    // Reset button state
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                });
            }

            // Initialize page
            document.addEventListener('DOMContentLoaded', function() {
                // Add smooth animations
                const forms = document.querySelectorAll('.wallet-form');
                forms.forEach(form => {
                    form.style.transition = 'all 0.3s ease';
                });
                
                // Load wallet data
                loadWalletData();
            });

            // Add form validation
            document.addEventListener('DOMContentLoaded', function() {
                // USDT address validation
                const usdtInput = document.getElementById('usdt-address');
                if (usdtInput) {
                    usdtInput.addEventListener('input', function() {
                        const value = this.value.trim();
                        if (value) {
                            const isTRC20 = /^T[A-Za-z1-9]{33}$/.test(value);
                            const isERC20 = /^0x[a-fA-F0-9]{40}$/.test(value);
                            const isOmni = /^[13][a-km-zA-HJ-NP-Z1-9]{25,34}$/.test(value);
                            
                            if (isTRC20 || isERC20 || isOmni) {
                                this.classList.remove('border-red-300');
                                this.classList.add('border-green-300');
                            } else {
                                this.classList.remove('border-green-300');
                                this.classList.add('border-red-300');
                            }
                        } else {
                            this.classList.remove('border-red-300', 'border-green-300');
                        }
                    });
                }

                // ETH address validation
                const ethInput = document.getElementById('eth-address');
                if (ethInput) {
                    ethInput.addEventListener('input', function() {
                        const value = this.value.trim();
                        if (value) {
                            const isValidETH = /^0x[a-fA-F0-9]{40}$/.test(value);
                            
                            if (isValidETH) {
                                this.classList.remove('border-red-300');
                                this.classList.add('border-green-300');
                            } else {
                                this.classList.remove('border-green-300');
                                this.classList.add('border-red-300');
                            }
                        } else {
                            this.classList.remove('border-red-300', 'border-green-300');
                        }
                    });
                }

                // PayPal email validation
                const paypalInput = document.getElementById('paypal-address');
                if (paypalInput) {
                    paypalInput.addEventListener('input', function() {
                        const value = this.value.trim();
                        if (value) {
                            const isValidEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);
                            
                            if (isValidEmail) {
                                this.classList.remove('border-red-300');
                                this.classList.add('border-green-300');
                            } else {
                                this.classList.remove('border-green-300');
                                this.classList.add('border-red-300');
                            }
                        } else {
                            this.classList.remove('border-red-300', 'border-green-300');
                        }
                    });
                }
            });
        </script>
    </body>

</html>